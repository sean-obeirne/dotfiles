#!/usr/bin/env bash
set -euo pipefail

# ---- EDIT: monitor -> FG,BG pairs (workspaces) ----
# Use names from: hyprctl monitors
declare -A PAIRS
PAIRS[DP-3]="1,3"
PAIRS[DP-2]="2,4"
# ---------------------------------------------------

need() { command -v "$1" >/dev/null 2>&1 || { echo "Missing dep: $1" >&2; exit 1; }; }
need hyprctl
need jq

aw="$(hyprctl -j activewindow || true)"
[ -z "$aw" ] && { echo "No active window."; exit 0; }

cur_ws="$(jq -r '.workspace.id' <<<"$aw")"
mon_id="$(jq -r '.monitor' <<<"$aw")"
[ "$mon_id" = "null" ] && { echo "Cannot detect monitor id."; exit 1; }

# Map monitor id -> name
mon_name="$(hyprctl -j monitors | jq -r --argjson mid "$mon_id" '.[] | select(.id==$mid) | .name')"
[ -z "$mon_name" ] && { echo "Monitor name not found for id $mon_id."; exit 1; }

pair="${PAIRS[$mon_name]:-}"
[ -z "$pair" ] && { echo "No FG/BG mapping for monitor $mon_name."; exit 1; }

IFS=, read -r FG BG <<<"$pair"

# Decide destination
dest="$FG"
if [[ "$cur_ws" == "$FG" ]]; then
  dest="$BG"
elif [[ "$cur_ws" == "$BG" ]]; then
  dest="$FG"
fi

# Move the focused window; don't change your current view
hyprctl dispatch movetoworkspace "$dest" >/dev/null

# Optional toast
command -v notify-send >/dev/null 2>&1 && \
  notify-send "Hyprland" "Moved active window â†’ workspace $dest on $mon_name"

